name: "M1 — MetaF Bootstrap & Installer"
description: "Bootstrap and pin MetaF, compute deterministic bundle identity, write logs and avoid global state mutation."
title: "M1 — MetaF Bootstrap & Installer"
labels:
  - "milestone:M1"
  - "area:metaf"
  - "area:bootstrap"
  - "area:installer"
  - "tests"
  - "docs"
body:
  - type: markdown
    attributes:
      value: |
        ## Goal
        Enable the application to install and pin MetaF into an app‑owned cache.  
        This milestone implements a `MetaFInstaller` that supports both `repo_release_zip` and `dotnet_publish` modes, computes a canonical
        `METAF_BUNDLE_SHA` manifest hash, persists install paths back into `config.yaml`, writes bootstrap logs with retention, and
        performs a clean‑cache retry on failure.  Installation must not modify global machine state.

  - type: textarea
    id: context
    attributes:
      label: Context / Links
      description: Link spec sections, roadmap sections, prior issues/PRs, and any relevant notes.
      placeholder: |
        - Spec: docs/spec.final.md§8.1,§11,§12.1
        - Roadmap: docs/roadmap.md§5.1–5.11 (M1)
        - Related: <ISSUE_OR_PR_LINKS>
    validations:
      required: false

  - type: markdown
    attributes:
      value: |
        ## Scope

        ### In
        - **Installation modes**: support both `repo_release_zip` (download a release ZIP) and `dotnet_publish` (build from a 40‑hex commit) modes for installing MetaF.
        - **Installer**: download/install MetaF into `APP_WORK_DIR`; verify idempotent installation and compute/persist `METAF_BUNDLE_SHA` using the canonical manifest algorithm.
        - **Configuration update**: persist `METAF_ROOT_DIR`, `METAF_EXE_PATH` and `METAF_BUNDLE_SHA` back into `config.yaml`.
        - **Bootstrap logs**: write logs under `APP_WORK_DIR\logs\bootstrap` and retain the most recent 50 entries.
        - **Error handling**: on bootstrap failure, clear the cache and retry once before surfacing a stable error code.
        - **Prerequisites**: validate the presence of required tools (`git`, `dotnet`) and optionally provision an app‑managed .NET runtime in `APP_WORK_DIR\deps\dotnet` without altering the global environment.
        - **UI integration**: add UI to trigger install/verify MetaF, display status and allow users to open logs.

        ### Out
        - Conversion pipelines (`.met→.af` or `.af→.met`) and mapping logic.
        - Plan/Preview generation and conflict handling.
        - Repair mapping and relink workflows (M4).

  - type: checkboxes
    id: execution
    attributes:
      label: Execution checklist
      description: Check as implementation items are completed.
      options:
        - label: "Implement support for `repo_release_zip` installation mode (download release ZIP, extract to cache)"
        - label: "Implement support for `dotnet_publish` installation mode (build from 40‑hex commit)"
        - label: "Install MetaF into `APP_WORK_DIR` and verify idempotently"
        - label: "Compute canonical manifest and persist `METAF_BUNDLE_SHA`"
        - label: "Persist `METAF_ROOT_DIR` and `METAF_EXE_PATH` to `config.yaml`"
        - label: "Write bootstrap logs and enforce retention (keep most recent 50 logs)"
        - label: "On failure, clear the cache and retry once before erroring"
        - label: "Validate prerequisites (`git`, `dotnet`); optionally provision app‑managed runtime"
        - label: "Integrate install/verify UI with status and log viewing"
        - label: "Add unit tests for manifest algorithm, retention behaviour and retry logic"

  - type: checkboxes
    id: dod
    attributes:
      label: Definition of Done
      description: Check as items are satisfied.
      options:
        - label: "MetaF installs successfully via both supported modes and is verified via UI"
        - label: "`METAF_BUNDLE_SHA` computed deterministically and surfaced in app state/logs"
        - label: "Install paths persist correctly into `config.yaml`"
        - label: "Bootstrap logs are captured and retention capped to 50 entries"
        - label: "Clean‑cache retry executes and surfaces failure with stable error code"
        - label: "Installer never mutates global machine state (no PATH/registry edits)"
        - label: "Milestone‑scoped acceptance tests pass (AT‑0009–AT‑0013)"

  - type: checkboxes
    id: exit_artifacts
    attributes:
      label: Exit artifacts
      description: Evidence to attach/link before closing.
      options:
        - label: "Installer binary/scripts and verification evidence (logs/test output)"
        - label: "Manifest/hash unit tests and algorithm notes"
        - label: "Log retention proof (e.g., 51st log evicted)"
        - label: "Updated `config.yaml` documenting installed paths and bundle hash"
        - label: "Documentation: prerequisites, troubleshooting and bootstrap workflow"
        - label: "Roadmap change log updated if scope changed"

  - type: textarea
    id: blockers
    attributes:
      label: Blockers / Risks
      description: List concrete blockers, risks, and mitigation steps.
      placeholder: |
        - Blocker:
        - Risk:
        - Mitigation:
    validations:
      required: false

  - type: textarea
    id: pr_links
    attributes:
      label: PR links / commits
      description: Add links to PRs or commit SHAs implementing this milestone work.
      placeholder: |
        - PR:
        - Commit:
    validations:
      required: false